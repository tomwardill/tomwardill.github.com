<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Tom Wardill]]></title>
  <link href="http://blog.howrandom.net/atom.xml" rel="self"/>
  <link href="http://blog.howrandom.net/"/>
  <updated>2016-07-21T14:50:15+01:00</updated>
  <id>http://blog.howrandom.net/</id>
  <author>
    <name><![CDATA[Tom Wardill]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Monitoring - A talk from PyConUK 2012]]></title>
    <link href="http://blog.howrandom.net/blog/2012/10/01/monitoring-a-talk-from-pyconuk-2012/"/>
    <updated>2012-10-01T20:05:00+01:00</updated>
    <id>http://blog.howrandom.net/blog/2012/10/01/monitoring-a-talk-from-pyconuk-2012</id>
    <content type="html"><![CDATA[<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.001.jpg" width="350" height="350" title="Slide 1" ></p>

<p>This is a write up of a talk that I gave at PyConUK 2012. It seemed to go pretty well, though it&rsquo;s not hugely technical. If you were there, I hope you enjoyed it, if you weren&rsquo;t, I hope you find this write up interesting.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.002.jpg" width="350" height="350" title="Slide 2" ></p>

<p>Given that work were paying for me to be there, I had to get at least one plug in; though there is a point to this slide.</p>

<p>Server Monitoring is easy, the tools exist and are plug and play now. Install the monitoring agent of your choice: <a href="http://www.serverdensity.com">we do a very nice solution</a> and away you go.</p>

<p>It&rsquo;s perhaps time to see if we can move the techniques and software developed for monitoring server hardware and move them to monitoring things that aren&rsquo;t servers.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.003.jpg" width="350" height="350" title="Slide 3" ></p>

<p>Heh.</p>

<p>Always say just the one thing controversial in any presentation. This one is mine.</p>

<p>While it&rsquo;s not meant entirely literally, there&rsquo;s a part truth in this. Starting development seems like a lot of slog to get to making a small dot moving around the screen. Everyone wants to make Quake (or the equivalent), and would prefer not to go through the boring stages of making the early stages.</p>

<p>Personally, I find hardware more impressive from the outset. A flashing LED that I&rsquo;ve wired together isn&rsquo;t technically much harder than &lsquo;Hello World&rsquo;, but it certainly feels like I&rsquo;ve acheived more. Perhaps this can be used to introduce kids to programming, rather than the current pure-software approaches.</p>

<p>One of the themes of this talk is that the current state of electronics has never been easier or cheaper. Software is boring, but hardware is impressive.</p>

<p>So, not entirely true, but I hope you can understand my point.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.004.jpg" width="350" height="350" title="Slide 4" ></p>

<p>This slide is fairly obvious, except that there are two meanings to &lsquo;cheap&rsquo;.
Obviously python is free, so monetarily it is cheap. The other meaning ties into the Library Support, there is so much python in existence, that there are usually multiple libraries for the same problem.
This makes it cheap to change between them, if you try a library and don&rsquo;t get on with it, throw it out and choose another.</p>

<p>External Dependencies is important, python is &lsquo;batteries included&rsquo;, it tends to ship with pretty much everything you&rsquo;d require to get started. The core library has modules for a lot of stuff.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.005.jpg" width="350" height="350" title="Slide 5" ></p>

<p>Yep, that&rsquo;s fairly obvious. There&rsquo;s a bunch of stuff that I can&rsquo;t think of, and haven&rsquo;t seen. There&rsquo;s a lot of people out there doing this type of thing at the minute, so it&rsquo;s getting easier every time.</p>

<h2>Things you can monitor - a non-exhaustive list</h2>

<p>There&rsquo;s not much I can say about these other than the contents of the slides, so SLIDES AWAY.</p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.006.jpg" width="350" height="350" title="Slide 6" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.007.jpg" width="350" height="350" title="Slide 7" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.008.jpg" width="350" height="350" title="Slide 8" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.009.jpg" width="350" height="350" title="Slide 9" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.010.jpg" width="350" height="350" title="Slide 10" ></p>

<h2>Monitoring</h2>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.011.jpg" width="350" height="350" title="Slide 11" ></p>

<p>The most common types of data that you will encounter in monitoring is the float, closely followed by the boolean. Number of times the cat has left the house today, and is the cat currently in the house?</p>

<p>Time is important, any instantaneous time measurement can be treated as a time series, given a longer scale.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.012.jpg" width="350" height="350" title="Slide 12" ></p>

<p>Accurate time is the most important thing, particularly if you are monitoring many disparate things. Without an accurate and joint time base to compare everything against, you&rsquo;ll end up doing a lot of work to shift the timebase to something useful.</p>

<h2>How to do it</h2>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.013.jpg" width="350" height="350" title="Slide 13" ></p>

<p>These are the two most effective tools you can have. A Raspberry Pi and an Arduino. The difference have been talked about many times, so I won&rsquo;t go over them.
Short story, the Pi is more independent, the Arduino has better inputs and currently a better ecosystem around it.</p>

<p>There is however, nothing stopping you strapping an Ardunio to a Pi and having the best of both worlds (but doubling the cost of whatever project you have).</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.014.jpg" width="350" height="350" title="Slide 14" ></p>

<p>This is some code. It&rsquo;s fairly simple code, mostly taken from the example and demos of two projects. Given a Garmin Heart Rate Monitor, an ANT+ usb stick, a Raspberry Pi and a 100mA gauge, this will display your Heart Rate on the console, and on the gauge.</p>

<p>Simple project that took me a couple of hours to put together, starting with nothing but the bits. Wiring this into some form of monitoring / graphing website would be equally straightforward.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.015.jpg" width="350" height="350" title="Slide 15" ></p>

<p>Host software.</p>

<p>Take Data. Make Graph.</p>

<p>Also, the question that started this was &lsquo;can you graph your git commits against your heart rate, work out which bug annoyed you the most, and how many cups of tea it took to solve?&rsquo;
The graph is most of the answer. It&rsquo;s something I built for a <a href="http://www.leedshack.com">hackday</a> using the Heart Rate monitoring from above. It&rsquo;s my git commits on the project against my heart rate at the time. It kind of worked, you can see where I got up to walk around and where I was at my most calm.</p>

<h2>Things you can use</h2>

<p>Again, non-exhaustive, but stuff I&rsquo;ve found that&rsquo;s cheap and easy. Most of it&rsquo;s fairly obvious.</p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.016.jpg" width="350" height="350" title="Slide 16" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.017.jpg" width="350" height="350" title="Slide 17" >
<img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.018.jpg" width="350" height="350" title="Slide 18" ></p>

<h2>Feedback of Monitoring</h2>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.019.jpg" width="350" height="350" title="Slide 19" ></p>

<p>Lots of ways of getting feedback from your monitoring. Lights, sounds and graphs are pretty easy to do, that type of thing is pretty much a solved problem with regards to server monitoring, so just hijack that and use it for whatever else you can feed into it.</p>

<p>Of course, THE INTERNETS is your easiest method, Twitter, emails, anything like that has an api and a library to interact with it in python.</p>

<p><br />
<br /></p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.020.jpg" width="350" height="350" title="Slide 20" ></p>

<p>Well, not quite monitoring. But it is a twitter controlled colour changing tent built from a RaspberryPi and some Dioder units from IKEA. From the minds of <a href="http://twitter.com/mikechislett">Mike</a> and <a href="http://twitter.com/user_4574">Nathan</a>.</p>

<h2>Costs</h2>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/monitoring/Monitoring.021.jpg" width="350" height="350" title="Slide 21" ></p>

<p>Yup, quite cheap really. Not penny sweets cheap, but this stuff is all commercially available, and consumer grade. Easy to pick up off the shelf.</p>

<h2>The End</h2>

<p>So that&rsquo;s the end, I hope it&rsquo;s been a worthwhile read.</p>

<p>Monitor everything, you never know when or where the data might be useful.</p>

<p><a href="http://twitter.com/tomwardill">@tomwardill</a> if you have any comments or suggestions.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Touchatag on OSX with tagEventor]]></title>
    <link href="http://blog.howrandom.net/blog/2012/09/08/touchatag-on-osx-with-tageventor/"/>
    <updated>2012-09-08T10:58:00+01:00</updated>
    <id>http://blog.howrandom.net/blog/2012/09/08/touchatag-on-osx-with-tageventor</id>
    <content type="html"><![CDATA[<p>I&rsquo;m planning a talk on monitoring things that aren&rsquo;t servers. The physical realm is something we all interact with, but very rarely actually monitor.</p>

<p>Part of this involves a touchatag (tikitag) RFID reader, my laptop and an Oyster card.</p>

<p>The easiest way to do &lsquo;if this card turns up, do this&rsquo; is some software called <a href="http://code.google.com/p/tageventor/">tagEventor</a>. A simple daemon that listen to the card, and will run a given script for a particular card.</p>

<p>Herein lies instructions on how to make it work on OSX (Mountain Lion in my case, but instructions should apply to most).</p>

<h2>PCSCD</h2>

<p>This is the system daemon for talking to card readers. It&rsquo;s shipped with OSX and has the required dependencies. It needs a modification to the config to work with the Touchatag (as it ships with an unrecognised firmware).</p>

<pre><code>sudo vim /usr/libexec/SmartCardServices/drivers/ifd-ccid.bundle/Contents/Info.plist

Change 
&lt;key&gt;ifdDriverOptions&lt;/key&gt;
&lt;string&gt;0x0000&lt;/string&gt;

to

&lt;key&gt;ifdDriverOptions&lt;/key&gt;
&lt;string&gt;0x0004&lt;/string&gt;
</code></pre>

<p>And either restart the system or run the daemon manually with</p>

<pre><code>sudo /usr/sbin/pcscd -f
</code></pre>

<h2>tagEventor</h2>

<p>Currently, the easiest way to get this is to build it from source, using <a href="https://github.com/bettse/tagEventor">this github branch from bettse</a>.</p>

<p>You will need XCode installed, as it&rsquo;s structured as an XCode project.</p>

<ol>
<li>Clone the branch from github</li>
<li>Open the XCode project</li>
<li>Product > Build</li>
<li>In the left column in XCode, dropdown &lsquo;Products&rsquo;, right click tagEventor and select &lsquo;Show in Finder&rsquo;</li>
<li>Copy the tagEventor binary to somewhere useful</li>
<li>In a terminal, cd to where you put the binary, and run <code>./tagEvent -v 3</code></li>
</ol>


<p>If everything is successful, you will see the output of tagEventor scroll by. If you don&rsquo;t, check that pcscd is running, and try testing that with <code>pcsctest</code>.</p>

<p>Once tagEventor is running, poke a rfid card at it (Oyster cards work), and you should see it detect the card and attempt to run a script. Remove the card and you should see similar output.</p>

<p>Create that script in whatever you&rsquo;re favoured language is, and it&rsquo;ll be executed with arguments when the card appears and leaves.</p>

<p>Enjoy your physical computer interface</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Monitoring your house power usage with Server Density]]></title>
    <link href="http://blog.howrandom.net/blog/2012/07/13/monitoring-your-house-power-usage-with-server-density/"/>
    <updated>2012-07-13T21:50:00+01:00</updated>
    <id>http://blog.howrandom.net/blog/2012/07/13/monitoring-your-house-power-usage-with-server-density</id>
    <content type="html"><![CDATA[<p>A while back, I bought a <a href="http://www.currentcost.com/product-envi.html">Current Cost Envi</a> power monitor for my house. Being something of a geek, I also bought the usb connecting cable. Unfortunately, the monitoring software provided is windows only, and not actually all that much use for monitoring over a period of time.</p>

<p>What we need is graphs. Lots of graphs.</p>

<p>My initial stab at this one was some <a href="https://github.com/tomwardill/py-power-cost">custom code</a> that listened to the usb serial output, logged it to a local database then uploaded it to a remote server. This worked fine, but was a reasonably complex way of doing it. And I never quite got the graphs to work correctly.</p>

<p>Then I started working for <a href="http://www.serverdensity.com">Server Density</a>. We do server monitoring, and make graphs. The agent that does this can make plugins. The little gears in my mind started working overtime (Yes, it&rsquo;s actually pretty obvious what&rsquo;s coming, but hey&hellip;).</p>

<p>A condensed and simplified version of the listening daemon later, and I got this:</p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/housepower.jpg" title="Power usage graph" ></p>

<p>A bit more playing around, and this was possible:</p>

<p><img src="https://github.com/tomwardill/tomwardill.github.com/raw/source/source/media/images/housetemperature.jpg"></p>

<p>So now I can see how warm my lounge is from anywhere in the world. Technology, it&rsquo;s great, ain&rsquo;t it?</p>

<h2>How to make it work</h2>

<p>First, you&rsquo;ll need the code. That&rsquo;s on github.</p>

<p>   <div><script src='https://gist.github.com/3117465.js?file=PowerCost.py'></script>
<noscript><pre><code>from StringIO import StringIO
from datetime import datetime
import serial
from lxml import etree</p>

<p>class PowerCost:</p>

<pre><code>def __init__(self, agentConfig, checksLogger, rawConfig):
    self.agentConfig = agentConfig
    self.checksLogger = checksLogger
    self.rawConfig = rawConfig

def convert_to_dict(self, msg):

    &amp;quot;&amp;quot;&amp;quot; Convert the xml msg into a python dictionary  &amp;quot;&amp;quot;&amp;quot;

    if not msg:
        return None

    io = StringIO(msg)
    data = {}

    # parse xml into dict
    tree = etree.parse(io)

    # check we have a msg we're interested in
    if not tree.xpath('//tmpr'):
        return None

    #data['time'] = tree.xpath('//time')[0].text
    data['time'] = datetime.now()
    data['temperature'] = tree.xpath('//tmpr')[0].text
    data['sensor_id'] = tree.xpath('//id')[0].text
    data['meter_type'] = tree.xpath('//type')[0].text

    if tree.xpath('//ch1'):
        data['ch1'] = tree.xpath('//ch1')[0].getchildren()[0].text
    if tree.xpath('//ch2'):
        data['ch2'] = tree.xpath('//ch2')[0].getchildren()[0].text
    else:
        data['ch2'] = 0
    if tree.xpath('//ch3'):
        data['ch3'] = tree.xpath('//ch3')[0].getchildren()[0].text
    else:
        data['ch3'] = 0

    return data


def run(self):

    ser = serial.Serial('/dev/ttyUSB0', 57600, timeout = 1)

    result = None

    while True:
        reading = ser.readline()
        if reading and reading.startswith('&amp;lt;'):
            converted = self.convert_to_dict(reading)
            if not converted:
                continue
            result = converted
            break

    ser.close()

    data = {'power': result['ch1'], 'temperature': result['temperature']}

    return data
</code></pre>

<p></code></pre></noscript></div></p>

<p>Then you&rsquo;ll need step one and two from <a href="http://support.serverdensity.com/knowledgebase/articles/76018-writing-a-plugin-linux-mac-and-freebsd">this guide</a></p>

<p>Pop the plugin file into the directory you&rsquo;ve set up, and name it PowerCost.py, and then restart your agent.
Then off you go.</p>

<p>Enjoy it, and remember, graphing thing is the way of life.</p>
]]></content>
  </entry>
  
</feed>
